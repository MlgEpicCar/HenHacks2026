{% extends "base.html" %}

{% block content %}

<div style="text-align: center;">
    <h1>Profile</h1>
    <h3>Express Yourself</h3>
</div>

<div style="display: flex;">
    <div style="flex: 1; max-width: 50%;">
        <form method="POST" class="profile_page">
            <h3>Say a little bit about yourself</h3>
            <textarea name="bio" placeholder="Bio" class="bio"
                    style="height: 5vh; width: 250px; padding: 0.3em; box-sizing: border-box; resize: vertical;">{{ user.bio }}</textarea>
            
            <h3>Choose Your Pal!</h3>
            <select class="dropdown" name="pfp">
                <option value="unknown" {% if user.pfp == "unknown" %}selected{% endif %}>None</option>
                <option value="dog" {% if user.pfp == "dog" %}selected{% endif %}>Dog</option>
                <option value="cat" {% if user.pfp == "cat" %}selected{% endif %}>Cat</option>
                <option value="penquin" {% if user.pfp == "penquin" %}selected{% endif %}>Penquin</option>
                <option value="blue_jellyfish" {% if user.pfp == "blue_jellyfish" %}selected{% endif %}>Blue Jellyfish</option>
                <option value="pink_jellyfish" {% if user.pfp == "pink_jellyfish" %}selected{% endif %}>Pink Jellyfish</option>
                <option value="burmer" {% if user.pfp == "burmer" %}selected{% endif %}>burmer</option>
            </select>
            <img class="preview"
            src="{{ url_for('static', filename='pfps/' + user.pfp + '.png') }}"
            alt="Profile Picture">
            <button type="submit">Save</button>
        </form>
    </div>

    <div style="flex: 1; max-width: 50%; display: flex; flex-direction: column; gap: 1rem;">
        <h2>Your Friends</h2>
        {% for friend in user.friends %}
            <div class='friends_box' style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; padding: 0.5rem; border: 2px solid #2e7d32; border-radius: 8px; margin-right: 30%; background-color: #49b44f;">
                <div style="display:flex; align-items:center; gap: 1rem;">
                    <img src="{{ url_for('static', filename='pfps/' + friend.pfp + '.png') }}" 
                        alt="{{ friend.username }} PFP" 
                        style="width:60px; height:60px; object-fit:cover;">
                    <div>
                        <strong>{{ friend.username }}</strong><br>
                        <span>{{ friend.bio }}</span>
                    </div>
                </div>

                <!-- Remove Friend Button -->
                <form method="POST" action="{{ url_for('remove_friend', friend_id=friend.id) }}" style="margin-right: 4%;">
                    <button type="submit" style="background:#2e7d32; color:white; border:none; padding:0.3rem 0.5rem; border-radius:4px; cursor:pointer;">
                        Remove
                    </button>
                </form>
            </div>
        {% else %}
            <p>No friends yet!</p>
        {% endfor %}

        <h3>Friend Requests</h3>
        {% for request in pending_requests %}
            <div class='friends_box' style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; padding: 0.5rem; border: 2px solid #f1d882; border-radius: 8px; margin-right: 30%; background-color: #ffeaa7;">
                <img src="{{ url_for('static', filename='pfps/' + request.from_user.pfp + '.png') }}" 
                    style="width:60px; height:60px; object-fit:cover;">
                <div>
                    <strong>{{ request.from_user.username }}</strong> wants to be your friend
                </div>
                <form method="POST" action="{{ url_for('respond_friend_request', request_id=request.id) }}" style="margin-right: 4%;">
                    <button name="action" value="accept" type="submit" style="background:#a38522; color:white; border:none; padding:0.3rem 0.5rem; border-radius:4px; cursor:pointer;" class="incoming_btns">Accept</button>
                    <button name="action" value="deny" type="submit" style="background:#a38522; color:white; border:none; padding:0.3rem 0.5rem; border-radius:4px; cursor:pointer;" class="incoming_btns">Deny</button>
                </form>
            </div>
        {% else %}
            <p>No pending requests</p>
        {% endfor %}
    </div>
</div>

<script>
    const dropdown = document.querySelector(".dropdown");
    const preview = document.querySelector(".preview");

    dropdown.addEventListener("change", function() {
        const selected = dropdown.value;
        preview.src = `/static/pfps/${selected}.png`;
    });
</script>

{% endblock %}